<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Repositorios de eversuelo</title>
  <!-- Cargar Tailwind CSS desde CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-3xl mx-auto p-4">
    <h1 class="text-3xl font-bold text-center my-6">Repositorios de eversuelo</h1>
    <div id="repoList" class="space-y-4"></div>
  </div>

  <script>
    const repoList = document.getElementById('repoList');

    // Función para formatear la fecha de actualización
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('es-ES');
    }

    // Obtener la lista de repositorios desde la API de GitHub
    fetch('https://api.github.com/users/eversuelo/repos')
      .then(response => response.json())
      .then(repos => {
        repos.forEach(repo => {
          // Crear la tarjeta para el repositorio
          const card = document.createElement('div');
          card.classList.add('bg-white', 'p-6', 'rounded', 'shadow', 'transition', 'hover:shadow-lg');

          // Título: enlace al repositorio
          const title = document.createElement('a');
          title.href = repo.html_url;
          title.target = '_blank';
          title.textContent = repo.name;
          title.classList.add('block', 'text-2xl', 'font-bold', 'text-blue-600', 'hover:underline');
          card.appendChild(title);

          // Descripción o main-url (se actualizará al obtener el README)
          const desc = document.createElement('p');
          desc.classList.add('mt-2', 'text-gray-600');
          desc.textContent = repo.description || 'Sin descripción disponible.';
          card.appendChild(desc);

          // Información adicional: lenguaje, estrellas, forks y última actualización
          const info = document.createElement('div');
          info.classList.add('mt-4', 'flex', 'flex-wrap', 'gap-4', 'text-sm', 'text-gray-500');

          if (repo.language) {
            const language = document.createElement('span');
            language.textContent = `Lenguaje: ${repo.language}`;
            info.appendChild(language);
          }

          const stars = document.createElement('span');
          stars.textContent = `★ ${repo.stargazers_count}`;
          info.appendChild(stars);

          const forks = document.createElement('span');
          forks.textContent = `Forks: ${repo.forks_count}`;
          info.appendChild(forks);

          const updated = document.createElement('span');
          updated.textContent = `Actualizado: ${formatDate(repo.updated_at)}`;
          info.appendChild(updated);

          card.appendChild(info);
          repoList.appendChild(card);

          // Intentar obtener el README para extraer "main-url:" si está presente
          fetch(`https://api.github.com/repos/eversuelo/${repo.name}/readme`)
            .then(response => {
              if (!response.ok) throw new Error('No se encontró README');
              return response.json();
            })
            .then(data => {
              // Decodificar el contenido (viene en Base64)
              const decoded = atob(data.content);
              // Buscar "main-url:" y capturar la URL que le sigue
              const regex = /main-url:\s*(\S+)/i;
              const match = decoded.match(regex);
              if (match && match[1]) {
                desc.innerHTML = `Main URL: <a href="${match[1]}" target="_blank" class="text-blue-500 underline">${match[1]}</a>`;
              }
            })
            .catch(err => {
              // Si no se encuentra el README o la etiqueta, se mantiene la descripción por defecto.
            });
        });
      })
      .catch(error => {
        console.error('Error al cargar repositorios:', error);
        repoList.textContent = "Error al cargar repositorios.";
      });
  </script>
</body>
</html>
